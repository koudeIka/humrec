<?php
try {
	require_once('../application_top.php');


	switch($_POST['action'])
	{

		case 'save_show':
			$new = new news($_POST['new_id']);
			if ($_POST['new_show'] == "false")
			{
				$new->new_show = 0;
			} else
			{
				$new->new_show = 1;
			}
			$new->save();
			break;


		case 'load_accueil':

			$new = new news($_POST['new_id']);
			echo "
			<fieldset class='new_title'>
				<legend>Titre</legend>
				<input type='text' value=\"".$new->new_title."\" class='ui-state-default' />
			</fieldset>
			<fieldset class='new_content'>
				<legend>Contenu</legend>
				<textarea>".$new->new_content."</textarea>
			</fieldset>
			<!--<fieldset class='acc_img'>
				<legend>Image</legend>
				<div class='img_show'>
					";
					if (!empty($accueil->acc_img))
					{
						echo "<span class='delete_img ui-state-default ui-corner-all'><span class='ui-icon ui-icon-circle-close'>&nbsp;</span></span><img src='".$INI['path']['accueil'].$accueil->acc_img."' />";
					}
				echo "
					<div style='clear: both; height: 1px;'>&nbsp;</div>
				</div>
				<p><b>Attention ! votre image sera affichée au format 260px par 134px et doit porter une extension de JPG, PNG ou GIF.</b></p>
				<span class='load_img' id='load_img'>Charger une image</span>
			</fieldset>

			<fieldset class='acc_link'>
				<legend>Lien</legend>
				<label>
					Ajouter un lien
				</label>
				<ul>
					<li>";
					$pos = strpos($accueil->acc_link, "actualite");
					if ($pos !== false)
					{
						$link_found = true;
						echo "<input type='radio' name='link_type' value='actualites' checked='checked' />";
					} else
					{
						echo "<input type='radio' name='link_type' value='actualites' />";
					}
					echo " Vers une actualité</li><li>";
					$pos = strpos($accueil->acc_link, "promotion");
					if ($pos !== false)
					{
						$link_found = true;
						echo "<input type='radio' name='link_type' value='promotions' checked='checked' />";
					} else
					{
						echo "<input type='radio' name='link_type' value='promotions'  />";
					}
					echo " Vers une promotion</li><li>";
					if ( ($accueil->acc_link != '') && ($link_found === false) )
					{
						$link_found = true;
						echo "<input type='radio' name='link_type' value='libre' checked='checked' />";
					} else
					{
						echo "<input type='radio' name='link_type' value='libre' />";
					}
					echo " Lien libre</li><li>";
					if ($accueil->acc_link == '')
					{
						echo "<input type='radio' name='link_type' value='vide' checked='checked' />";
					} else
					{
						echo "<input type='radio' name='link_type' value='vide' />";
					}
					echo " Pas de lien</li>
				</ul>
				<p><input type='text' name='acc_link' value=\"".$accueil->acc_link."\" /></p>
				<div class='acc_link_show'>
					<label>
						Afficher le lien
					</label>
					<p>";
					if ( ($accueil->acc_link_show == 'yes') || ($accueil->acc_link_show == '') )
					{
						echo "
						<input type='radio' name='acc_link_show' value='yes' checked='checked' /> oui
						<input type='radio' name='acc_link_show' value='no' /> non
						";
					} else
					{
						echo "
						<input type='radio' name='acc_link_show' value='yes' /> oui
						<input type='radio' name='acc_link_show' value='no' checked='checked' /> non
						";
					}
					echo "
					</p>
				</div>
			</fieldset>-->
			";
			break;

		case 'save_new_title':
			$new = new news($_POST['new_id']);
			$new->new_title = $_POST['new_title'];
			$new->save();
			break;


		case 'save_new_content':
			$new = new news($_POST['new_id']);
			$new->new_content = $_POST['new_content'];
			$new->save();
			break;

// 		case 'upload_image':
// 			$ext = pathinfo($_FILES['userfile']['name'], PATHINFO_EXTENSION);
// 			$ext = strtolower($ext);
//
// 			$nom_fichier = "accueil-".$_POST['acc_id'].".".$ext;
//
// 			if (move_uploaded_file($_FILES['userfile']['tmp_name'], $INI['folder']['accueil'].$nom_fichier))
// 			{
// 				$accueil = new accueil($_POST['acc_id']);
// 				$accueil->acc_img = $nom_fichier;
// 				$accueil->save();
// 			}
//
//
// 			break;
//
//
// 		case 'load_image_standalone':
// 			$accueil = new accueil($_POST['acc_id']);
// 			echo "<span class='delete_img ui-state-default ui-corner-all'><span class='ui-icon ui-icon-circle-close'>&nbsp;</span></span><img src='".$INI['path']['accueil'].$accueil->acc_img."' />";
// 			break;
//
// 		case 'delete_image':
// 			$accueil = new accueil($_POST['acc_id']);
// 			@unlink($INI['folder']['accueil'].$accueil->acc_img);
// 			$accueil->acc_img = "";
// 			$accueil->save();
// 			break;
//
// 		case 'load_popup_link':
//
// 			switch($_POST['type'])
// 			{
// 				case "actualites":
// 					echo "<label>Lien vers l'actualité...</label><br/><select name='actualite'>
// 						<option value=''>...</option>
// 					";
// 					foreach (actualites::getAll() as $act_id)
// 					{
// 						$actualite = new actualites($act_id);
// 						echo "<option value='".$actualite->act_id."'>".$actualite->act_title."</option>";
// 					}
// 					echo "</select>";
// 					break;
//
// 				case "promotions":
// 					echo "<label>Lien vers la promotion...</label><br/><select name='promotion'>
// 						<option value=''>...</option>
// 					";
// 					foreach (promotions::getAll() as $pro_id)
// 					{
// 						$promotion = new promotions($pro_id);
// 						echo "<option value='".$promotion->pro_id."'>".$promotion->pro_title."</option>";
// 					}
// 					echo "</select>";
// 					break;
// 			}
//
//
// 			break;
//
// 		case 'save_link':
// 			$accueil = new accueil($_POST['acc_id']);
// 			$accueil->acc_link = $_POST['acc_link'];
// 			$accueil->acc_link_type = $_POST['acc_link_type'];
// 			$accueil->acc_link_show = $_POST['acc_link_show'];
// 			$accueil->save();
// 			break;
//
		case 'add_new':
			$new = new news();
			$new->new_show = 0;
			$new->save();

			echo "
			<div id='new_id_".$new->new_id."' data-new_id='".$new->new_id."' class='new ui-widget ui-widget-header ui-corner-all'>
				<h2>&nbsp;</h2>
				<label class='label'>Visible sur le site</label>
				<input type='checkbox' class='new_show' />
				<span class='button_delete'>&nbsp;</span>
			</div>";

			echo $accueil->acc_id.":::
			<div id='acc_id_".$accueil->acc_id."' class='accueil ui-widget ui-widget-header ui-corner-all'>
				<h2>&nbsp;</h2>
				<label class='label'>Visible sur le site</label>
				<input type='checkbox' class='acc_show' />
				<span class='button_delete'>&nbsp;</span>
				<span class='button_move'>&nbsp;</span>
			</div>";

			break;

		case 'delete_new':
			news::delete($_POST['new_id']);
			break;
	}
}
catch(Exception $e) { echo $e->getMessage()."<br/>on ".$e->getFile()." line ".$e->getLine(); };
?>